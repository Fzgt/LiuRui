import{_ as k,c as r,J as i,m as s,w as d,a as n,ao as g,E as a,o}from"./chunks/framework.E0VnI2yM.js";const c="/assets/an-openresty-log-missing-on-everyday-0-issue-troubleshooting-and-fix-record-screenshot-01.BiD9fbWY.png",L=JSON.parse('{"title":"è®°ä¸€æ¬¡ OpenResty æ—¥å¿—åœ¨ 0 ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³","description":"","frontmatter":{"tags":["è®¡ç®—æœº/ç½‘ç»œ/ç½‘å…³/Nginx","è®¡ç®—æœº/ç½‘ç»œ/ç½‘å…³/OpenResty","å¼€å‘/æ•…éšœæ’æŸ¥"]},"headers":[],"relativePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/ğŸšª ç½‘å…³/è®°ä¸€æ¬¡ OpenResty æ—¥å¿—åœ¨ 0 ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³.md","filePath":"ç¬”è®°/ğŸ› ï¸ å¼€å‘/ğŸšª ç½‘å…³/è®°ä¸€æ¬¡ OpenResty æ—¥å¿—åœ¨ 0 ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³.md"}'),C={name:"ç¬”è®°/ğŸ› ï¸ å¼€å‘/ğŸšª ç½‘å…³/è®°ä¸€æ¬¡ OpenResty æ—¥å¿—åœ¨ 0 ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³.md"},y=s("h1",{id:"è®°ä¸€æ¬¡-openresty-æ—¥å¿—åœ¨-0-ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³",tabindex:"-1"},[n("è®°ä¸€æ¬¡ OpenResty æ—¥å¿—åœ¨ 0 ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³ "),s("a",{class:"header-anchor",href:"#è®°ä¸€æ¬¡-openresty-æ—¥å¿—åœ¨-0-ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³","aria-label":'Permalink to "è®°ä¸€æ¬¡ OpenResty æ—¥å¿—åœ¨ 0 ç‚¹ä¸¢å¤±é—®é¢˜çš„æ’æŸ¥å’Œè§£å†³"'},"â€‹")],-1),F=s("h3",{id:"æ–‡æ¡£å…¼å®¹æ€§",tabindex:"-1"},[n("æ–‡æ¡£å…¼å®¹æ€§ "),s("a",{class:"header-anchor",href:"#æ–‡æ¡£å…¼å®¹æ€§","aria-label":'Permalink to "æ–‡æ¡£å…¼å®¹æ€§"'},"â€‹")],-1),A=s("thead",null,[s("tr",null,[s("th",null,"ä¸»ä½“"),s("th",null,"ç‰ˆæœ¬å·"),s("th",null,"æ–‡æ¡£åœ°å€ï¼ˆå¦‚æœæœ‰ï¼‰")])],-1),D=s("tr",null,[s("td",null,"Debian"),s("td",null,"11/5.10.127-1/amd64"),s("td")],-1),u=s("td",null,"OpenResty",-1),_=s("td",null,"openresty/1.21.4.1",-1),x=s("h2",{id:"èµ·å› ",tabindex:"-1"},[n("èµ·å›  "),s("a",{class:"header-anchor",href:"#èµ·å› ","aria-label":'Permalink to "èµ·å› "'},"â€‹")],-1),v=s("p",null,"æœ€æ—©å‘ç°è¿™ä¸ªé—®é¢˜çš„èµ·å› æ˜¯æˆ‘åœ¨æŸ¥è¯¢ç½‘ç«™ç»Ÿè®¡çš„æ—¶å€™ã€‚",-1),f=s("p",null,"æˆ‘æŸ¥è¯¢æ—¶å‘ç°ä¼šæœ‰å¤§æ®µçš„æ—¶é—´æ²¡æœ‰æ•°æ®å¯ä»¥å±•ç¤ºå’Œç»Ÿè®¡å‡ºæ¥ï¼Œä¹Ÿä¼šå‘ç°å…¶å®æ•°æ®ä¸å¤ªçœŸå®ï¼Œç™»å½•åˆ° Kibana å¯¹ç½‘ç«™çš„ç½‘å…³æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥è°ƒæŸ¥ä¹‹åå°±èƒ½å‘ç°ä¸€äº›ç«¯å€ªã€‚",-1),m=g(`<p>æˆ‘å‘ç°ä¼¼ä¹åœ¨ 0 ç‚¹ä¹‹åæ•°æ®æµå°±ä¼šåœæ­¢ä¼ è¾“ï¼Œæ— è®ºæ˜¯å“ªä¸ªè¯·æ±‚ URI éƒ½æ˜¯å¦‚æ­¤ã€‚æˆ‘ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜å¤šæ¬¡é‡å¯è¿‡ OpenResty çš„è¿›ç¨‹ï¼Œæ¯æ¬¡é‡å¯ä¹‹åéƒ½ä¼šæ¢å¤æ­£å¸¸ï¼Œä½†æ˜¯åˆ°äº† 0 ç‚¹ä¹‹ååˆä¼š 100% æ–­å¼€ã€‚</p><p>æˆ‘ä¼˜å…ˆæ’æŸ¥çš„ OpenRestyï¼Œç¡®è®¤äº† OpenResty æ²¡æœ‰å‘ç”Ÿé‡è½½å’Œé‡å¯ï¼Œæˆ‘ä¹Ÿå»æ’æŸ¥äº† Logstash å’Œ Filebeat çš„è¿è¡Œæ—¥å¿—ï¼Œå‘ç°è¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ²¡æœ‰å‘ç”Ÿè¿‡é‡æ–°å¯åŠ¨ï¼Œæ—¥å¿—é‡Œä¹Ÿæ²¡æœ‰æåˆ°æœ‰å‡ºç°é”™è¯¯ï¼Œä½†æ˜¯ Filebeat çš„ stdout æ—¥å¿—ä¸­ä¼šå¤§é‡æåˆ°ã€Œåœ¨è¿‡å» xx æ—¶é—´æ®µå†…æ²¡æœ‰ä»»ä½•æ—¥å¿—ã€ã€‚</p><p>è¿™ååˆ†å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¼šæ²¡æœ‰æ—¥å¿—å‘¢ï¼Ÿ</p><p>å¦‚æœæˆ‘ä»¬åˆ—å‡ºåœ¨ OpenResty é…ç½®æ–‡ä»¶å½“ä¸­é…ç½®çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ <code>/var/log/nginx</code> ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å…¶å® <code>access.log</code> æ˜¯ä¼šæœ‰å¥½å‡ ä»½ç»“å°¾ä¸º <code>.&lt;æ•°å­—&gt;.gz</code> å¤åˆ¶çš„ã€‚å¦å¤–ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯æ˜¯ï¼šæˆ‘è¿™é‡Œçš„ OpenResty æ˜¯ä»åŸå…ˆé»˜è®¤é…ç½®çš„ Nginx ä¸­è¿ç§»è¿‡æ¥çš„ï¼Œä¸”åœ¨ Debian ç³»ç»Ÿä¸­å®‰è£… Nginx çš„ä¼šè‡ªåŠ¨é…ç½®é»˜è®¤çš„ Logrotate ç­–ç•¥ï¼Œä¸å¹¸çš„æ˜¯ï¼Œæˆ‘è¿ç§»ä¹‹åå¹¶æ²¡æœ‰å•ç‹¬ä¸º OpenResty è¿›è¡Œè¿‡ Logrotate ç­–ç•¥çš„è°ƒæ•´å’Œé‡æ–°é…ç½®ï¼Œä¹Ÿè®¸æ˜¯è¿™ä¸ªç­–ç•¥å¯¼è‡´çš„é—®é¢˜ã€‚</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/log/nginx/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">æ€»ç”¨é‡</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">        0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 28</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 27</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 10:34</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 26</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 15:39</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.2.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 10:54</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.3.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 16</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 23:56</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.4.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 15</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 23:21</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.5.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 23:59</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.6.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 23:50</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.7.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 23:59</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.8.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r-----</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    adm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  8æœˆ</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 23:58</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> access.log.9.gz</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥æ‰“å¼€ <code>/etc/logrotate/conf.d/nginx</code> çœ‹çœ‹ï¼Œå¯ä»¥å‘ç°é‡Œé¢æœ‰ä¸€è¡Œ <code>postrotate</code> é…ç½®ï¼Œè¿™è¡Œé…ç½®ä¸‹é¢æœ‰ä¸€ä¸ª <code>if</code> æ¡ä»¶åˆ¤æ–­çš„è¯­å¥ä¼´éšï¼Œå…¶å«ä¹‰æ˜¯ï¼š å¦‚æœ <code>/var/run/nginx.pid</code> å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>kill -USR1 &lt;Nginx è¿›ç¨‹ ID&gt;</code> å‘½ä»¤å°† Nginx æ€æ‰å¹¶é‡æ–°è½½å…¥ã€‚æˆ‘å°è±¡é‡Œæˆ‘åœ¨è¿ç§» OpenResty çš„æ—¶å€™å¯¹ pid è·¯å¾„è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œæœ‰å¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰è¯»å–åˆ° <code>/var/run/nginx.pid</code>ï¼Œä¸” Logrotate ä¾ç„¶æŠŠåŸå…ˆçš„æ–‡ä»¶åˆ‡åˆ†åˆ°äº†æ–°çš„æ–‡ä»¶é‡Œï¼Œå¯¼è‡´åŸå…ˆ OpenResty æ‰“å¼€çš„æ—¥å¿—æ–‡ä»¶çš„ file descriptor æ— æ³•å†æ¬¡è¿›è¡Œå†™å…¥äº†ï¼Œä½†æ˜¯ä¹Ÿæ— æ³•æ­£å¸¸å…³é—­ï¼Œä¹Ÿè®¸æ˜¯è¿™ä¹ˆä¸ªåŸå› ï¼Ÿ</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/var/log/nginx/*.log {</span></span>
<span class="line"><span>        daily</span></span>
<span class="line"><span>        missingok</span></span>
<span class="line"><span>        rotate 52</span></span>
<span class="line"><span>        compress</span></span>
<span class="line"><span>        delaycompress</span></span>
<span class="line"><span>        notifempty</span></span>
<span class="line"><span>        create 640 nginx adm</span></span>
<span class="line"><span>        sharedscripts</span></span>
<span class="line"><span>        postrotate</span></span>
<span class="line"><span>                if [ -f /var/run/nginx.pid ]; then</span></span>
<span class="line"><span>                        kill -USR1 \`cat /var/run/nginx.pid\`</span></span>
<span class="line"><span>                fi</span></span>
<span class="line"><span>        endscript</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æˆ‘åˆ° OpenResty çš„æ–‡ä»¶ä¸­å¯¹ PID æ–‡ä»¶è·¯å¾„é…ç½®è¿›è¡Œäº†æ£€æŸ¥ï¼Œå‘ç°ç¡®å®å’Œ Logrotate é…ç½®ä¸­çš„æœ‰åŒºåˆ«ï¼Œä¹Ÿå¤§æ¦‚å’Œæˆ‘ä¸Šé¢çŒœæƒ³çš„æƒ…å†µä¸€æ¨¡ä¸€æ ·ã€‚</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">user </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> nginx;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> auto;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /usr/local/openresty/nginx/logs/error.log </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">notice</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">pid </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       /usr/local/openresty/nginx/logs/nginx.pid;</span></span></code></pre></div><p>æˆ‘ä»¬å†æ¬¡æ‰“å¼€ Logrotate å¯¹ Nginx æ—¥å¿—çš„ rotate ç­–ç•¥è¿›è¡Œç¼–è¾‘ï¼š</p><p>æŠŠåŸå…ˆçš„é”™è¯¯è„šæœ¬</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-f</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /var/run/nginx.pid ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">		kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -USR1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/run/nginx.pid\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">fi</span></span></code></pre></div><p>æ›¿æ¢ä¸ºä½¿ç”¨æ­£ç¡® PID è·¯å¾„çš„è„šæœ¬</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-f</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /usr/local/openresty/nginx/logs/nginx.pid ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">	    kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -USR1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/openresty/nginx/logs/nginx.pid\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">fi</span></span></code></pre></div><p>å¾—åˆ°ä¸‹é¢çš„ Logrotate æ–‡ä»¶ï¼š</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/usr/local/openresty/nginx/logs/*.log {</span></span>
<span class="line"><span>        daily</span></span>
<span class="line"><span>        missingok</span></span>
<span class="line"><span>        rotate 52</span></span>
<span class="line"><span>        compress</span></span>
<span class="line"><span>        delaycompress</span></span>
<span class="line"><span>        notifempty</span></span>
<span class="line"><span>        create 640 nginx adm</span></span>
<span class="line"><span>        sharedscripts</span></span>
<span class="line"><span>        postrotate</span></span>
<span class="line"><span>                if [ -f /usr/local/openresty/nginx/logs/nginx.pid ]; then</span></span>
<span class="line"><span>                        kill -USR1 \`cat /usr/local/openresty/nginx/logs/nginx.pid\`</span></span>
<span class="line"><span>                fi</span></span>
<span class="line"><span>        endscript</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>å†æ¬¡é‡æ–°å¯åŠ¨æ•´ä¸ª OpenRestyï¼Œè§‚å¯Ÿä¸¤å¤©ä¹‹åå‘ç°ä¿®å¤å®Œæˆäº†ã€‚</p><h2 id="è´¡çŒ®è€…" tabindex="-1">è´¡çŒ®è€… <a class="header-anchor" href="#è´¡çŒ®è€…" aria-label="Permalink to &quot;è´¡çŒ®è€…&quot;">â€‹</a></h2>`,18),b=s("h2",{id:"æ–‡ä»¶å†å²",tabindex:"-1"},[n("æ–‡ä»¶å†å² "),s("a",{class:"header-anchor",href:"#æ–‡ä»¶å†å²","aria-label":'Permalink to "æ–‡ä»¶å†å²"'},"â€‹")],-1);function P(B,E,R,z,O,N){const p=a("NolebasePageProperties"),l=a("VPNolebaseInlineLinkPreview"),e=a("NolebaseUnlazyImg"),t=a("NolebaseGitContributors"),h=a("NolebaseGitChangelog");return o(),r("div",null,[y,i(p),F,s("table",null,[A,s("tbody",null,[D,s("tr",null,[u,_,s("td",null,[i(l,{href:"https://openresty.org/en/",target:"_blank",rel:"noreferrer"},{default:d(()=>[n("OpenRestyÂ® - Official Site")]),_:1})])])])]),x,v,f,s("p",null,[i(e,{src:c,alt:"",thumbhash:"/OcFAYKjRfyKh/hapIpPmvg=",placeholderSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAFCAYAAAAkG+5xAAACpElEQVR4AQCBAH7/AP///////////P////H09//q7e//6Ozu/+7z9P/6////////////////////////////////////+f7//+3z9P/o7e7/6e7w//H19//8////////////////////////////////////////////////////////////////////AIEAfv8A8f/8/+v69v/g7+z/1eXh/83d2f/M3Nj/0eHd/9zt6P/p+vb/9f////v////6////8v///+X38v/X6eT/zN3Z/8fY0//J2tb/0uLe/9/u6v/s+vf/9v////z////9////+v////b////z/Pz/8/v7//b9/f/6//////////////8AgQB+/wDd9O3/1u7m/8zk3P/B2dH/udLJ/7fQyP+91s3/x+HY/9Tu5f/f+fD/5f/2/+P99P/a9ez/zefe/7/Z0P+0zsX/r8nA/7LLw/+81Mz/yeHZ/9ju5//k+fL/6//5/+3/+//s/vn/6fr2/+f48//o+PT/6/r3//D/+//1////+P///wCBAH7/AOb48//g8+3/1unk/8zf2f/F2NL/xNfS/8rd2P/V6eP/4vfx/+7//P/0////8v///+n++P/c8Or/zeLb/8LW0P+90Mr/v9LM/8ja1f/V5+L/4/Pv/+7++v/1////9/////X////x/Pv/7vn4/+749//x+vr/9f7+//r////9////AYEAfv8A+/////X9/f/s9PT/4uvq/9zl5P/c5eT/4+zr/+/4+P/9//////////////////////////j////p8/L/3efm/9fg4P/Z4eH/4ejp/+309P/6///////////////////////////////9/f//+/r///37/////v////////////+WaF+a/ijBLQAAAABJRU5ErkJggg==",width:"1898",height:"206",autoSizes:"true"})]),m,i(t),b,i(h)])}const S=k(C,[["render",P]]);export{L as __pageData,S as default};
